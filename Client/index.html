<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser-ce/2.10.3/phaser.min.js"></script>
</head>
<body>
<script>
var game = new Phaser.Game(768, 768, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {
    game.load.image('gold', './assets/Gold.png');
    game.load.image('ground', './assets/background.png');
    game.load.image('myhero', './assets/Tuskan-Marine.png');
}

var player;
var cursors;
var turn = true;
var second = 10;

TurnEndTimer = setInterval(fTurnEnd, 10000);

function fTurnEnd () {
    turn = false;
    labelTurn.setText(turn === true ? 'Ваш ход' : 'Ход соперника');
}

function getRandomInt(max) {
  return Math.floor(Math.random() * Math.floor(max));
}

let secondsTimer = setInterval(seconds, 1000);

function seconds() {
    if (second === 1) {
        clearTimeout(secondsTimer);
        //secondsTimer.delete();
    }
    second = second - 1;
    timer.setText(second);
    /*if (second === 0) {
        second = 11;
    }*/
}


function create() {
    //read playerId
	if (localStorage.getItem('playerId')!=null) {
		playerId = localStorage.getItem('playerId');
	} else {
		playerId = getRandomInt(1000);
		localStorage.setItem('playerId', playerId);
	}
		
    game.physics.startSystem(Phaser.Physics.ARCADE);

    game.add.sprite(0, 0, 'ground');

    game.world.setBounds(0, 0, 768, 768);//may be it will not work because of #23
    player = game.add.sprite(game.world.centerX-30, game.world.centerY-70, 'myhero');
    //player.scale(0.25,0.25);
    timer = game.add.text(380, 20, second);
    labelTurn = game.add.text(450, 20, turn === true ? 'Ваш ход' : 'Ход соперника');
    game.add.sprite(660, 0, 'gold');

    game.physics.arcade.enable(player);
    cursors = game.input.keyboard.createCursorKeys();

    this.spaceKey = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
    game.input.keyboard.addKeyCapture([ Phaser.Keyboard.ESC, Phaser.Keyboard.SPACEBAR ]);
}

function update() {
    
    function moveTo(x, y, player) {
        player.x = x;
        player.y = y;
        turn = false;
    }
    player.body.velocity.x = 0;
    player.body.velocity.y = 0;

	if (turn === true) {
		if (cursors.up.isDown)
		{
			moveTo(player.x,player.y-32,player);
		}
		else if (cursors.down.isDown)
		{
			moveTo(player.x,player.y+32,player);
		}
		if (cursors.left.isDown)
		{
			moveTo(player.x-32,player.y,player);
		}
		else if (cursors.right.isDown)
		{
			moveTo(player.x+32,player.y,player);
		}
		 
		if (this.spaceKey.isDown)
		{
			turn = false;
		}
	}
}
function endGame() { 
	localStorage.removeItem('playerId');
}
</script>
</body>
</html>
